# 概念 (Concept)
欢迎阅读这个文档，这里我们将介绍一些基本的概念。

## 分布式定时任务
### 任务批次
即每次任务到达执行时间时，系统会先产生一个新的批次，一个批次会包含一个或多个任务项

### 任务项
系统最小的可执行单元，负责向客户端下发任务，记录任务执行的结果以及日志信息

### 路由策略
- 轮询: 轮询路由策略是一种简单而有效的方法，按照顺序依次将任务分发给不同的节点，确保任务在集群中平均分布，达到负载均衡的效果。
- 一致性Hash: 一致性Hash路由策略基于哈希函数，将任务和节点映射到一个固定的哈希环上。这样，当有新的节点加入或节点离开时，只需重新计算少量的映射关系，而不会影响到大部分任务的分配。这种策略保持了相对的稳定性和负载均衡。
- 随机: 随机路由策略是将任务随机分配给集群中的一个节点。每次任务触发时，系统会随机选择一个节点来执行任务。尽管简单，但也具有一定的负载均衡效果，适用于某些场景下的随机化需求。
- LRU (Least Recently Used): LRU路由策略基于最近使用的原则，将任务分配给最近最少被使用的节点。这种策略保持了节点的活跃性，避免任务集中在某个节点上执行，从而提高系统的性能和稳定性。

### 阻塞策略
- 丢弃策略： 丢弃策略是一种简单的阻塞策略，当处理速度无法跟上任务批次的产生速度时，新产生任务批次将被直接丢弃，从而保持系统的稳定性。
- 覆盖策略： 覆盖策略是指当新的任务批次产生时，如果上一个任务批次仍在处理中，将产生一个新的批次覆盖掉正在处理的批次，系统开始处理新的批次。
- 并行策略： 并行策略允许系统同时处理多个批次，无需等待前一个批次处理完成。这种策略可以提高系统的处理能力，但需要考虑线程安全和资源竞争等问题。

## 触发类型
### 固定时间:
以固定的间隔时长进行执行
### CRON:
根据CRON表达式进行执行
### 工作流:
通过工作流进行执行

## 执行器类型
### Java类型
1. @JobExecutor注解模式: 支持无参和JobArgs参数，同时可作用于类和方法上，作用与类上时可以指定方法名称
2. 继承AbstractJobExecutor模式: 使用类的全路径

## 任务类型
- 集群模式: 当客户端部署节点数>=1时，同一时间只会在一个节点执行任务，确保任务的单一执行性。
- 广播模式: 每次任务触发时，所有活跃的客户端都会执行一次任务，实现任务的广泛触达和执行。
- 分片模式: 按照预定的分片数量，轮询地将任务依次下发给活跃的客户端，实现任务的分布式处理和优化执行。

## 超时时间(秒)
每次任务执行的最长时间, 达到超时时间的任务，关闭任务同时根据阻塞策略执行相应的策略

## 最大重试次数
重试的触发条件是服务端下发任务执行指令的时候，客户端由于网络不通、连接超时、客户端执行失败等异常时，服务端执行一定次数的重试，保障一定的可达性

## 并行数
当前批次允许多少任务同时执行. 在分片模式下可能存在一个客户端节点的同一批次可能执行两个以上的分片任务.

## 分布式重试
这部分内容包括以下几点：

### 组 (group)
> 组不支持自动创建，在使用前必须在控制台手动创建一个组

组是一个逻辑概念, 它可以看做是场景的分类或者是标签, 用于将一些相关性的场景进行分组，可以理解为MQ的Topic和Queue的关系; 服务端的负载均衡也是基于组
把不同的组分配到不同的服务端集群的其中一个节点。

### 场景(scene)
> 在配置组时选择自动创建场景，则系统发现存在场景时会自动创建一个场景

每个组对应N个场景且同一个组不能有相同的场景，场景是系统配置的最小单位

### 重试策略(retryStrategy)
本地重试: 与`SpringRetry`或者`GuavaRetry`模式一样，仅在内存重在一定时间范围内进行N次的重试
远程重试: 将异常的数据上报到服务端，服务端依据对应场景配置的退避策略、重试上限等进行重试流量下发

### 幂等id(idempotentId)
同一个组的同一个场景下只会存在一个相同的idempotentId并且状态为'重试中'的任务, 若存在相同的则上报服务后会被幂等处理
比如:

- 组: AGroup
- 场景: BScene
- 时刻1: 上报一个异常 idempotentId: A1 状态为重试中
- 时刻2: 上报一个异常 idempotentId: A2 状态为重试中，可以上报成功，此时存在两个重试任务
- 时刻3: 上报一个异常 idempotentId: A1 不会新增一个重试任务，会被幂等处理
- 时刻4:  idempotentId: A1 重试完成, 状态为已完成
- 时刻5: 上报一个异常 idempotentId: A1 状态为重试中, 新增一条重试任务

### 业务编号(bizNo)
用于标识具有业务特点的值, 比如订单号、物流编号等，可以根据具体的业务场景生成，生成规则采用通用成熟的Spel表达式进行解析

### 回调
重试任务状态为终态时(完成或到达最大次数)，系统会产生一条与之对应的回调任务，客户端根据自身的业务特点执行一些操作，比如告警等

## 第二部分

这里我们进一步探讨更多的概念。

- **概念四**：详细信息。
- **概念五**：详细信息。
- **概念六**：详细信息。