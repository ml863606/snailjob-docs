---
title: v2.5.0
date: 2023-11-18 11:25:26
permalink: /pages/2eacc2/
---

<code-group>
  <code-block title="Mysql&MariaDB数据库" active>

```sql
ALTER TABLE `group_config` DROP INDEX `uk_name`;

ALTER TABLE `group_config` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `group_config` ADD UNIQUE INDEX `uk_namespace_id_group_name`(`namespace_id`, `group_name`) USING BTREE;

ALTER TABLE `job` DROP INDEX `idx_group_name`;

ALTER TABLE `job` DROP INDEX `idx_next_trigger_at`;

ALTER TABLE `job` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `job` MODIFY COLUMN `task_type` tinyint(4) NOT NULL DEFAULT 1 COMMENT '任务类型 1、集群 2、广播 3、切片';

ALTER TABLE `job` MODIFY COLUMN `block_strategy` tinyint(4) NOT NULL DEFAULT 1 COMMENT '阻塞策略 1、丢弃 2、覆盖 3、并行';

ALTER TABLE `job` ADD INDEX `idx_namespace_id_group_name`(`namespace_id`, `group_name`) USING BTREE;

ALTER TABLE `job` ADD INDEX `idx_job_status_bucket_index`(`job_status`, `bucket_index`) USING BTREE;

ALTER TABLE `job` ADD INDEX `idx_create_dt`(`create_dt`) USING BTREE;

ALTER TABLE `job_log_message` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `job_log_message` ADD INDEX `idx_task_batch_id_task_id`(`task_batch_id`, `task_id`) USING BTREE;

ALTER TABLE `job_log_message` ADD INDEX `idx_create_dt`(`create_dt`) USING BTREE;

ALTER TABLE `job_log_message` ADD INDEX `idx_namespace_id_group_name`(`namespace_id`, `group_name`) USING BTREE;

ALTER TABLE `job_task` DROP INDEX `idx_task_batch_id`;

ALTER TABLE `job_task` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `job_task` MODIFY COLUMN `client_info` varchar(128)  NULL DEFAULT NULL COMMENT '客户端地址 clientId#ip:port';

ALTER TABLE `job_task` ADD INDEX `idx_task_batch_id_task_status`(`task_batch_id`, `task_status`) USING BTREE;

ALTER TABLE `job_task` ADD INDEX `idx_create_dt`(`create_dt`) USING BTREE;

ALTER TABLE `job_task` ADD INDEX `idx_namespace_id_group_name`(`namespace_id`, `group_name`) USING BTREE;

ALTER TABLE `job_task_batch` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `job_task_batch` ADD COLUMN `parent_id` varchar(64)  NOT NULL DEFAULT '' COMMENT '父节点';

ALTER TABLE `job_task_batch` ADD INDEX `idx_create_dt`(`create_dt`) USING BTREE;

ALTER TABLE `job_task_batch` ADD INDEX `idx_namespace_id_group_name`(`namespace_id`, `group_name`) USING BTREE;

ALTER TABLE `notify_config` DROP INDEX `idx_group_name`;

ALTER TABLE `notify_config` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `notify_config` ADD COLUMN `scene_name` varchar(64)  NOT NULL COMMENT '场景名称';

ALTER TABLE `notify_config` ADD COLUMN `rate_limiter_status` tinyint(4) NOT NULL DEFAULT 0 COMMENT '限流状态 0、未启用 1、启用';

ALTER TABLE `notify_config` ADD COLUMN `rate_limiter_threshold` int(11) NOT NULL DEFAULT 0 COMMENT '每秒限流阈值';

ALTER TABLE `notify_config` MODIFY COLUMN `notify_status` tinyint(4) NOT NULL DEFAULT 0 COMMENT '通知状态 0、未启用 1、启用';

ALTER TABLE `notify_config` ADD INDEX `idx_namespace_id_group_name`(`namespace_id`, `group_name`) USING BTREE;

ALTER TABLE `retry_dead_letter_0` DROP INDEX `uk_name_unique_id`;

ALTER TABLE `retry_dead_letter_0` DROP INDEX `idx_group_name_scene_name`;

ALTER TABLE `retry_dead_letter_0` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `retry_dead_letter_0` MODIFY COLUMN `scene_name` varchar(64)  NOT NULL COMMENT '场景名称';

ALTER TABLE `retry_dead_letter_0` ADD UNIQUE INDEX `uk_namespace_id_group_name_unique_id`(`namespace_id`, `group_name`, `unique_id`) USING BTREE;

ALTER TABLE `retry_dead_letter_0` ADD INDEX `idx_namespace_id_group_name_scene_name`(`namespace_id`, `group_name`, `scene_name`) USING BTREE;

ALTER TABLE `retry_task_0` DROP INDEX `uk_name_unique_id`;

ALTER TABLE `retry_task_0` DROP INDEX `idx_group_name_scene_name`;

ALTER TABLE `retry_task_0` DROP INDEX `idx_retry_status`;

ALTER TABLE `retry_task_0` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `retry_task_0` ADD UNIQUE INDEX `uk_name_unique_id`(`namespace_id`, `group_name`, `unique_id`) USING BTREE;

ALTER TABLE `retry_task_0` ADD INDEX `idx_namespace_id_group_name_scene_name`(`namespace_id`, `group_name`, `scene_name`) USING BTREE;

ALTER TABLE `retry_task_0` ADD INDEX `idx_namespace_id_group_name_task_type`(`namespace_id`, `group_name`, `task_type`) USING BTREE;

ALTER TABLE `retry_task_0` ADD INDEX `idx_namespace_id_group_name_retry_status`(`namespace_id`, `group_name`, `retry_status`) USING BTREE;

ALTER TABLE `retry_task_log` DROP INDEX `idx_group_name_scene_name`;

ALTER TABLE `retry_task_log` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `retry_task_log` ADD INDEX `idx_group_name_scene_name`(`namespace_id`, `group_name`, `scene_name`) USING BTREE;

ALTER TABLE `retry_task_log_message` DROP INDEX `idx_group_name_unique_id`;

ALTER TABLE `retry_task_log_message` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `retry_task_log_message` ADD INDEX `idx_namespace_id_group_name_scene_name`(`namespace_id`, `group_name`, `unique_id`) USING BTREE;

ALTER TABLE `scene_config` DROP INDEX `uk_group_name_scene_name`;

ALTER TABLE `scene_config` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `scene_config` ADD UNIQUE INDEX `uk_namespace_id_group_name_scene_name`(`namespace_id`, `group_name`, `scene_name`) USING BTREE;

ALTER TABLE `sequence_alloc` DROP INDEX `uk_group_name`;

ALTER TABLE `sequence_alloc` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `sequence_alloc` ADD UNIQUE INDEX `uk_namespace_id_group_name`(`namespace_id`, `group_name`) USING BTREE;

ALTER TABLE `server_node` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `server_node` ADD INDEX `idx_namespace_id_group_name`(`namespace_id`, `group_name`) USING BTREE;

ALTER TABLE `system_user_permission` DROP INDEX `uk_group_name_system_user_id`;

ALTER TABLE `system_user_permission` ADD COLUMN `namespace_id` varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id';

ALTER TABLE `system_user_permission` ADD UNIQUE INDEX `uk_namespace_id_group_name_system_user_id`(`namespace_id`, `group_name`, `system_user_id`) USING BTREE;

CREATE TABLE `namespace`
(
    `id`          bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
    `name`        varchar(64)  NOT NULL COMMENT '名称',
    `unique_id`   varchar(64)  NOT NULL COMMENT '唯一id',
    `description` varchar(256) NOT NULL DEFAULT '' COMMENT '描述',
    `create_dt`   datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_dt`   datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
    `deleted`     tinyint(4) NOT NULL DEFAULT '0' COMMENT '逻辑删除 1、删除',
    PRIMARY KEY (`id`),
    KEY           `idx_name` (`name`),
    UNIQUE KEY `uk_unique_id` (`unique_id`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4 COMMENT ='命名空间';

INSERT INTO `namespace` (`id`, `name`, `unique_id`, `create_dt`, `update_dt`, `deleted`)
VALUES (1, 'Default', '764d604ec6fc45f68cd92514c40e9e1a', now(), now(), 0);

CREATE TABLE `job_notify_config`
(
    `id`                     bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
    `namespace_id`           varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id',
    `group_name`             varchar(64)  NOT NULL COMMENT '组名称',
    `job_id`                 bigint(20) NOT NULL COMMENT '任务id',
    `notify_status`          tinyint(4) NOT NULL DEFAULT '0' COMMENT '通知状态 0、未启用 1、启用',
    `notify_type`            tinyint(4) NOT NULL DEFAULT '0' COMMENT '通知类型 1、钉钉 2、邮件 3、企业微信',
    `notify_attribute`       varchar(512) NOT NULL COMMENT '配置属性',
    `notify_threshold`       int(11) NOT NULL DEFAULT '0' COMMENT '通知阈值',
    `notify_scene`           tinyint(4) NOT NULL DEFAULT '0' COMMENT '通知场景',
    `rate_limiter_status`    tinyint(4) NOT NULL DEFAULT '0' COMMENT '限流状态 0、未启用 1、启用',
    `rate_limiter_threshold` int(11) NOT NULL DEFAULT '0' COMMENT '每秒限流阈值',
    `description`            varchar(256) NOT NULL DEFAULT '' COMMENT '描述',
    `create_dt`              datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_dt`              datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
    PRIMARY KEY (`id`),
    KEY                      `idx_namespace_id_group_name_job_id` (`namespace_id`,`group_name`, job_id)
) ENGINE=InnoDB
  AUTO_INCREMENT=4
  DEFAULT CHARSET=utf8mb4 COMMENT='job通知配置';

CREATE TABLE `job_summary`
(
    `id`            bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
    `namespace_id`  VARCHAR(64)     NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id',
    `group_name`    VARCHAR(64)     NOT NULL DEFAULT '' COMMENT '组名称',
    `job_id`        bigint          NOT NULL COMMENT '任务信息id',
    `trigger_at`    datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '统计时间',
    `success_num`   int             NOT NULL DEFAULT '0' COMMENT '执行成功-日志数量',
    `fail_num`      int             NOT NULL DEFAULT '0' COMMENT '执行失败-日志数量',
    `fail_reason`   varchar(512)    NOT NULL DEFAULT '' COMMENT '失败原因',
    `stop_num`      int             NOT NULL DEFAULT '0' COMMENT '执行失败-日志数量',
    `stop_reason`   varchar(512)    NOT NULL DEFAULT '' COMMENT '失败原因',
    `cancel_num`    int             NOT NULL DEFAULT '0' COMMENT '执行失败-日志数量',
    `cancel_reason` varchar(512)    NOT NULL DEFAULT '' COMMENT '失败原因',
    `create_dt`     datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_dt`     datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
    PRIMARY KEY (`id`),
    KEY `idx_namespace_id_group_name_job_id` (`namespace_id`, `group_name`, job_id),
    UNIQUE KEY `uk_job_id_trigger_at` (`job_id`, `trigger_at`) USING BTREE
) ENGINE = InnoDB
  AUTO_INCREMENT = 1
  DEFAULT CHARSET = utf8mb4 COMMENT ='DashBoard_Job';

CREATE TABLE `retry_summary`
(
    `id`            bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
    `namespace_id`  VARCHAR(64)     NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a' COMMENT '命名空间id',
    `group_name`    VARCHAR(64)     NOT NULL DEFAULT '' COMMENT '组名称',
    `scene_name`    VARCHAR(50)     NOT NULL DEFAULT '' COMMENT '场景名称',
    `trigger_at`    datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '统计时间',
    `running_num`   int             NOT NULL DEFAULT '0' COMMENT '重试中-日志数量',
    `finish_num`    int             NOT NULL DEFAULT '0' COMMENT '重试完成-日志数量',
    `max_count_num` int             NOT NULL DEFAULT '0' COMMENT '重试到达最大次数-日志数量',
    `suspend_num`   int             NOT NULL DEFAULT '0' COMMENT '暂停重试-日志数量',
    `create_dt`     datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_dt`     datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_scene_name_trigger_at` (`namespace_id`, `group_name`, `scene_name`, `trigger_at`) USING BTREE
) ENGINE = InnoDB
  AUTO_INCREMENT = 1
  DEFAULT CHARSET = utf8mb4 COMMENT ='DashBoard_Retry';
```
  </code-block>

  <code-block title="Postgres数据库">

```sql
ALTER TABLE "public"."group_config" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."group_config"."namespace_id" IS '命名空间';

ALTER TABLE "public"."job" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."job"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."job_log_message" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."job_log_message"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."notify_config" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."notify_config"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."notify_config" ADD COLUMN "scene_name" varchar(64) COLLATE "pg_catalog"."default" NOT NULL;

COMMENT ON COLUMN "public"."notify_config"."scene_name" IS '场景名称';

ALTER TABLE "public"."notify_config" ADD COLUMN "rate_limiter_status" int2 NOT NULL DEFAULT 0;

COMMENT ON COLUMN "public"."notify_config"."rate_limiter_status" IS '限流状态 0、未启用 1、启用';

ALTER TABLE "public"."notify_config" ADD COLUMN "rate_limiter_threshold" int4 NOT NULL DEFAULT 0;

COMMENT ON COLUMN "public"."notify_config"."rate_limiter_threshold" IS '每秒限流阈值';

ALTER TABLE "public"."retry_dead_letter_0" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."retry_dead_letter_0"."namespace_id" IS '命名空间id';

COMMENT ON COLUMN "public"."retry_dead_letter_0"."scene_name" IS '场景名称';

ALTER TABLE "public"."retry_task_0" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."retry_task_0"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."retry_task_log" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."retry_task_log"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."retry_task_log_message" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."retry_task_log_message"."namespace_id" IS '命名空间';

ALTER TABLE "public"."scene_config" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."scene_config"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."sequence_alloc" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."sequence_alloc"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."server_node" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."server_node"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."system_user_permission" ADD COLUMN "namespace_id" varchar(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."system_user_permission"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."job_task" ADD COLUMN "namespace_id" varchar(64) NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."job_task"."namespace_id" IS '命名空间id';

ALTER TABLE "public"."job_task_batch" ADD COLUMN "namespace_id" varchar(64) NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a';

COMMENT ON COLUMN "public"."job_task_batch"."namespace_id" IS '命名空间id';

DROP INDEX "public"."idx_group_name";

DROP INDEX "public"."idx_group_name_scene_name_retry_task_log";

CREATE INDEX "idx_group_name_scene_name_retry_task_log" ON "public"."retry_task_log"  (
  "namespace_id",
  "group_name",
  "scene_name"
);

CREATE INDEX "idx_namespace_id_group_name" ON "public"."notify_config"  (
  "namespace_id",
  "group_name"
);

CREATE INDEX "idx_namespace_id_group_name_job" ON "public"."job"  (
  "namespace_id",
  "group_name"
);

CREATE INDEX "idx_namespace_id_group_name_retry_status_retry_task" ON "public"."retry_task_0"  (
  "namespace_id",
  "group_name",
  "retry_status" "pg_catalog"."int2_ops" ASC NULLS LAST
);

CREATE INDEX "idx_namespace_id_group_name_scene_name_retry_dead_letter" ON "public"."retry_dead_letter_0"  (
  "namespace_id",
  "group_name",
  "scene_name"
);

CREATE INDEX "idx_namespace_id_group_name_scene_name_retry_task" ON "public"."retry_task_0"  (
  "namespace_id",
  "group_name",
  "scene_name"
);

CREATE INDEX "idx_namespace_id_group_name_server_node" ON "public"."server_node"  (
  "namespace_id",
  "group_name"
);

CREATE INDEX "idx_namespace_id_group_name_to_job_log_message" ON "public"."job_log_message"  (
  "namespace_id",
  "group_name"
);

CREATE INDEX "idx_namespace_id_group_name_to_job_task" ON "public"."job_task"  (
  "namespace_id",
  "group_name"
);

CREATE INDEX "idx_namespace_id_group_name_to_job_task_batch" ON "public"."job_task_batch"  (
  "namespace_id",
  "group_name"
);

CREATE INDEX "idx_namespace_id_group_name_unique_id" ON "public"."retry_task_log_message"  (
  "namespace_id",
  "group_name",
  "unique_id"
);

DROP INDEX "public"."idx_unique_id";

CREATE INDEX "idx_unique_id" ON "public"."retry_task_log"  (
  "namespace_id",
  "group_name",
  "unique_id"
);

DROP INDEX "public"."uk_name_unique_id_retry_task";

CREATE UNIQUE INDEX "uk_name_unique_id_retry_task" ON "public"."retry_task_0"  (
  "namespace_id",
  "group_name",
  "unique_id"
);

CREATE UNIQUE INDEX "uk_namespace_id_group_name" ON "public"."sequence_alloc"  (
  "namespace_id",
  "group_name"
);

CREATE UNIQUE INDEX "uk_namespace_id_group_name_group_config" ON "public"."group_config"  (
  "namespace_id",
  "group_name"
);

CREATE UNIQUE INDEX "uk_namespace_id_group_name_scene_name" ON "public"."scene_config" (
  "namespace_id",
  "group_name",
  "scene_name"
);

CREATE UNIQUE INDEX "uk_namespace_id_group_name_system_user_id" ON "public"."system_user_permission"  (
  "namespace_id",
  "group_name",
  "system_user_id"
);

CREATE UNIQUE INDEX "uk_namespace_id_group_name_unique_id_retry_dead_letter" ON "public"."retry_dead_letter_0"  (
  "namespace_id",
  "group_name",
  "unique_id"
);

DROP INDEX "public"."idx_group_name_scene_name_retry_dead_letter";

DROP INDEX "public"."idx_group_name_scene_name_retry_task";

DROP INDEX "public"."idx_group_name_to_job";

DROP INDEX "public"."idx_group_name_to_job_log_message";

DROP INDEX "public"."idx_group_name_to_job_task";

DROP INDEX "public"."idx_group_name_to_job_task_batch";

DROP INDEX "public"."idx_group_name_unique_id";

DROP INDEX "public"."idx_retry_status_retry_task";

DROP INDEX "public"."uk_group_name";

DROP INDEX "public"."uk_group_name_scene_name";

DROP INDEX "public"."uk_group_name_system_user_id";

DROP INDEX "public"."uk_name_group_config";

DROP INDEX "public"."uk_name_unique_id_retry_dead_letter";

CREATE TABLE namespace
(
    id          BIGSERIAL PRIMARY KEY,
    name        VARCHAR(64)  NOT NULL,
    unique_id   VARCHAR(64)  NOT NULL,
    description VARCHAR(256) NOT NULL DEFAULT '',
    create_dt   TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_dt   TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    deleted     SMALLINT     NOT NULL DEFAULT 0
);

CREATE UNIQUE INDEX uk_namespace_unique_id ON namespace (unique_id);

COMMENT ON COLUMN namespace.id IS '主键';
COMMENT ON COLUMN namespace.name IS '名称';
COMMENT ON COLUMN namespace.unique_id IS '唯一id';
COMMENT ON COLUMN namespace.description IS '描述';
COMMENT ON COLUMN namespace.create_dt IS '创建时间';
COMMENT ON COLUMN namespace.update_dt IS '修改时间';
COMMENT ON COLUMN namespace.deleted IS '逻辑删除 1、删除';
COMMENT ON TABLE namespace IS '命名空间';

CREATE TABLE job_notify_config
(
    id               BIGSERIAL PRIMARY KEY,
    group_name       VARCHAR(64)  NOT NULL,
    job_id            BIGINT      NOT NULL,
    notify_status    SMALLINT  NOT NULL DEFAULT 0,
    notify_type      SMALLINT     NOT NULL DEFAULT 0,
    notify_attribute VARCHAR(512) NOT NULL,
    notify_threshold INT          NOT NULL DEFAULT 0,
    notify_scene     SMALLINT     NOT NULL DEFAULT 0,
    rate_limiter_status    SMALLINT  NOT NULL DEFAULT 0,
    rate_limiter_threshold INT          NOT NULL DEFAULT 0,
    description      VARCHAR(256) NOT NULL DEFAULT '',
    create_dt        TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_dt        TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_group_name ON job_notify_config (group_name);

COMMENT ON COLUMN "job_notify_config"."id" IS '主键';
COMMENT ON COLUMN "job_notify_config"."group_name" IS '组名称';
COMMENT ON COLUMN "job_notify_config"."job_id" IS '任务信息id';
COMMENT ON COLUMN "job_notify_config"."notify_status" IS '通知状态 0、未启用 1、启用';
COMMENT ON COLUMN "job_notify_config"."notify_type" IS '通知类型 1、钉钉 2、邮件 3、企业微信';
COMMENT ON COLUMN "job_notify_config"."notify_attribute" IS '配置属性';
COMMENT ON COLUMN "job_notify_config"."notify_threshold" IS '通知阈值';
COMMENT ON COLUMN "job_notify_config"."notify_scene" IS '通知场景';
COMMENT ON COLUMN "job_notify_config"."rate_limiter_status" IS '限流状态 0、未启用 1、启用';
COMMENT ON COLUMN "job_notify_config"."rate_limiter_threshold" IS '每秒限流阈值';
COMMENT ON COLUMN "job_notify_config"."description" IS '描述';
COMMENT ON COLUMN "job_notify_config"."create_dt" IS '创建时间';
COMMENT ON COLUMN "job_notify_config"."update_dt" IS '修改时间';
COMMENT ON TABLE "job_notify_config" IS '通知配置';

CREATE TABLE retry_summary
(
    id            BIGSERIAL PRIMARY KEY,
    namespace_id  VARCHAR(64) NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a',
    group_name    VARCHAR(64) NOT NULL DEFAULT '',
    scene_name    VARCHAR(50) NOT NULL DEFAULT '',
    trigger_at    TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    running_num   INT         NOT NULL DEFAULT 0,
    finish_num    INT         NOT NULL DEFAULT 0,
    max_count_num INT         NOT NULL DEFAULT 0,
    suspend_num   INT         NOT NULL DEFAULT 0,
    create_dt     TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_dt     TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE UNIQUE INDEX uk_scene_name_trigger_at ON retry_summary ("namespace_id", "group_name", "scene_name", "trigger_at");

COMMENT ON COLUMN "retry_summary"."id" IS '主键';
COMMENT ON COLUMN "retry_summary"."namespace_id" IS '命名空间id';
COMMENT ON COLUMN "retry_summary"."group_name" IS '组名称';
COMMENT ON COLUMN "retry_summary"."scene_name" IS '场景名称';
COMMENT ON COLUMN "retry_summary"."trigger_at" IS '统计时间';
COMMENT ON COLUMN "retry_summary"."running_num" IS '重试中-日志数量';
COMMENT ON COLUMN "retry_summary"."finish_num" IS '重试完成-日志数量';
COMMENT ON COLUMN "retry_summary"."max_count_num" IS '重试到达最大次数-日志数量';
COMMENT ON COLUMN "retry_summary"."suspend_num" IS '暂停重试-日志数量';
COMMENT ON COLUMN "retry_summary"."create_dt" IS '创建时间';
COMMENT ON COLUMN "retry_summary"."update_dt" IS '修改时间';
COMMENT ON TABLE "retry_summary" IS 'DashBoard_Retry';

CREATE TABLE job_summary
(
    id            BIGSERIAL PRIMARY KEY,
    namespace_id  VARCHAR(64)  NOT NULL DEFAULT '764d604ec6fc45f68cd92514c40e9e1a',
    group_name    VARCHAR(64)  NOT NULL DEFAULT '',
    job_id        BIGINT       NOT NULL,
    trigger_at    TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    success_num   INT          NOT NULL DEFAULT 0,
    fail_num      INT          NOT NULL DEFAULT 0,
    fail_reason   VARCHAR(512) NOT NULL DEFAULT '',
    stop_num      INT          NOT NULL DEFAULT 0,
    stop_reason   VARCHAR(512) NOT NULL DEFAULT '',
    cancel_num    INT          NOT NULL DEFAULT 0,
    cancel_reason VARCHAR(512) NOT NULL DEFAULT '',
    create_dt     TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_dt     TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE UNIQUE INDEX uk_job_id_trigger_at ON job_summary ("job_id", "trigger_at");
CREATE INDEX idx_namespace_id_group_name_job_id ON job_summary ("namespace_id", "group_name", "job_id");

COMMENT ON COLUMN "job_summary"."id" IS '主键';
COMMENT ON COLUMN "job_summary"."namespace_id" IS '命名空间id';
COMMENT ON COLUMN "job_summary"."group_name" IS '组名称';
COMMENT ON COLUMN "job_summary"."job_id" IS '任务信息id';
COMMENT ON COLUMN "job_summary"."trigger_at" IS '统计时间';
COMMENT ON COLUMN "job_summary"."success_num" IS '执行成功-日志数量';
COMMENT ON COLUMN "job_summary"."fail_num" IS '执行失败-日志数量';
COMMENT ON COLUMN "job_summary"."fail_reason" IS '失败原因';
COMMENT ON COLUMN "job_summary"."stop_num" IS '执行失败-日志数量';
COMMENT ON COLUMN "job_summary"."stop_reason" IS '失败原因';
COMMENT ON COLUMN "job_summary"."cancel_num" IS '执行失败-日志数量';
COMMENT ON COLUMN "job_summary"."cancel_reason" IS '失败原因';
COMMENT ON TABLE "job_summary" IS 'DashBoard_Job';

```
  </code-block>

</code-group>