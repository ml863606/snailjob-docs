---
title: v2.4.0
date: 2023-11-18 11:25:26
permalink: /pages/2eacc1/
---

<code-group>
  <code-block title="Mysql&MariaDB数据库" active>

```sql
ALTER TABLE `group_config` ADD COLUMN `bucket_index` int(11) NOT NULL DEFAULT 0 COMMENT 'bucket' ;

ALTER TABLE `group_config` MODIFY COLUMN `description` varchar(256)  NOT NULL DEFAULT '' COMMENT '组描述';

ALTER TABLE `group_config` DROP COLUMN `route_key`;

ALTER TABLE `notify_config` ADD COLUMN `notify_status` tinyint(4) NOT NULL DEFAULT 0 COMMENT '组状态 0、未启用 1、启用';

ALTER TABLE `retry_task_log_message` ADD COLUMN `client_info` varchar(128) NULL DEFAULT NULL COMMENT '客户端地址 clientId#ip:port';

ALTER TABLE `scene_config` ADD COLUMN `executor_timeout` int(11) UNSIGNED NOT NULL DEFAULT 5 COMMENT '任务执行超时时间，单位秒' ;

ALTER TABLE `scene_config` ADD COLUMN `route_key` tinyint(4) NOT NULL DEFAULT 4 COMMENT '路由策略';


-- 分布式调度DDL
CREATE TABLE `job`
(
    `id`               bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
    `group_name`       varchar(64)  NOT NULL COMMENT '组名称',
    `job_name`         varchar(64)  NOT NULL COMMENT '名称',
    `args_str`         text                  DEFAULT NULL COMMENT '执行方法参数',
    `args_type`        tinyint(4) NOT NULL DEFAULT '1' COMMENT '参数类型 ',
    `next_trigger_at`  bigint(13) NOT NULL COMMENT '下次触发时间',
    `job_status`       tinyint(4) NOT NULL DEFAULT '1' COMMENT '重试状态 0、关闭、1、开启',
    `task_type`        tinyint(4) NOT NULL DEFAULT '1' COMMENT '任务类型 1、集群 2、广播 3、切片',
    `route_key`        tinyint(4) NOT NULL DEFAULT '4' COMMENT '路由策略',
    `executor_type`    tinyint(4) NOT NULL DEFAULT '1' COMMENT '执行器类型',
    `executor_info`    varchar(255)          DEFAULT NULL COMMENT '执行器名称',
    `trigger_type`     tinyint(4) NOT NULL COMMENT '触发类型 1.CRON 表达式 2. 固定时间',
    `trigger_interval` varchar(255) NOT NULL COMMENT '间隔时长',
    `block_strategy`   tinyint(4) NOT NULL DEFAULT '1' COMMENT '阻塞策略 1、丢弃 2、覆盖 3、并行',
    `executor_timeout` int(11) NOT NULL DEFAULT '0' COMMENT '任务执行超时时间，单位秒',
    `max_retry_times`  int(11) NOT NULL DEFAULT '0' COMMENT '最大重试次数',
    `parallel_num`     int(11) NOT NULL DEFAULT '1' COMMENT '并行数',
    `retry_interval`   int(11) NOT NULL DEFAULT '0' COMMENT '重试间隔(s)',
    `bucket_index`     int(11) NOT NULL DEFAULT '0' COMMENT 'bucket',
    `resident`         tinyint(4) NOT NULL DEFAULT '0' COMMENT '是否是常驻任务',
    `description`      varchar(256) NOT NULL DEFAULT '' COMMENT '描述',
    `ext_attrs`        varchar(256) NULL default '' COMMENT '扩展字段',
    `create_dt`        datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_dt`        datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
    `deleted`          tinyint(4) NOT NULL DEFAULT '0' COMMENT '逻辑删除 1、删除',
    PRIMARY KEY (`id`),
    KEY                `idx_group_name` (`group_name`),
    KEY                `idx_job_status_bucket_index` (`job_status`, `bucket_index`),
    KEY                `idx_create_dt` (`create_dt`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4 COMMENT='任务信息';

CREATE TABLE `job_log_message`
(
    `id`            bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
    `group_name`    varchar(64) NOT NULL COMMENT '组名称',
    `job_id`        bigint(20) NOT NULL COMMENT '任务信息id',
    `task_batch_id` bigint(20) NOT NULL COMMENT '任务批次id',
    `task_id`       bigint(20) NOT NULL COMMENT '调度任务id',
    `message`       text        NOT NULL COMMENT '调度信息',
    `create_dt`     datetime    NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `ext_attrs`     varchar(256) NULL default '' COMMENT '扩展字段',
    PRIMARY KEY (`id`),
    KEY             `idx_task_batch_id_task_id` (`task_batch_id`, `task_id`),
    KEY             `idx_create_dt` (`create_dt`),
    KEY             `idx_group_name` (`group_name`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4 COMMENT='调度日志';

CREATE TABLE `job_task`
(
    `id`             bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
    `group_name`     varchar(64) NOT NULL COMMENT '组名称',
    `job_id`         bigint(20) NOT NULL COMMENT '任务信息id',
    `task_batch_id`  bigint(20) NOT NULL COMMENT '调度任务id',
    `parent_id`      bigint(20) NOT NULL DEFAULT '0' COMMENT '父执行器id',
    `task_status`    tinyint(4) NOT NULL DEFAULT '0' COMMENT '执行的状态 0、失败 1、成功',
    `retry_count`    int(11) NOT NULL DEFAULT '0' COMMENT '重试次数',
    `client_info`    varchar(128)         DEFAULT NULL COMMENT '客户端地址 clientId#ip:port',
    `result_message` text        NOT NULL COMMENT '执行结果',
    `args_str`       text                 DEFAULT NULL COMMENT '执行方法参数',
    `args_type`      tinyint(4) NOT NULL DEFAULT '1' COMMENT '参数类型 ',
    `ext_attrs`      varchar(256) NULL default '' COMMENT '扩展字段',
    `create_dt`      datetime    NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_dt`      datetime    NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
    PRIMARY KEY (`id`),
    KEY              `idx_task_batch_id_task_status` (`task_batch_id`, `task_status`),
    KEY              `idx_create_dt` (`create_dt`),
    KEY              `idx_group_name` (`group_name`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4 COMMENT='任务实例';

CREATE TABLE `job_task_batch`
(
    `id`                bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
    `group_name`        varchar(64) NOT NULL COMMENT '组名称',
    `job_id`            bigint(20) NOT NULL COMMENT '任务id',
    `task_batch_status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '任务批次状态 0、失败 1、成功',
    `operation_reason`  tinyint(4) NOT NULL DEFAULT '0' COMMENT '操作原因',
    `execution_at`      bigint(13) NOT NULL DEFAULT '0' COMMENT '任务执行时间',
    `parent_id`        varchar(64) NOT NULL DEFAULT '' COMMENT '父节点',
    `create_dt`         datetime    NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_dt`         datetime    NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
    `deleted`           tinyint(4) NOT NULL DEFAULT '0' COMMENT '逻辑删除 1、删除',
    `ext_attrs`         varchar(256) NULL default '' COMMENT '扩展字段',
    PRIMARY KEY (`id`),
    KEY                 `idx_job_id_task_batch_status` (`job_id`, `task_batch_status`),
    KEY                 `idx_create_dt` (`create_dt`),
    KEY                 `idx_group_name` (`group_name`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4 COMMENT='任务批次';

```
  </code-block>

  <code-block title="Postgres数据库">

```sql

ALTER TABLE "group_config" ADD COLUMN "bucket_index" int4 NOT NULL DEFAULT 0;
COMMENT ON COLUMN "group_config"."bucket_index" IS 'bucket';

ALTER TABLE "group_config" DROP COLUMN "route_key";


ALTER TABLE "notify_config" ADD COLUMN "notify_status" int NOT NULL DEFAULT 0;
COMMENT ON COLUMN "notify_config"."notify_status" IS '通知状态 0、未启用 1、启用';

ALTER TABLE "retry_task_log_message" ADD COLUMN client_info VARCHAR(128) DEFAULT NULL ;
COMMENT ON COLUMN "retry_task_log_message"."client_info" IS '客户端地址 clientId#ip:port';

ALTER TABLE "scene_config" ADD COLUMN "route_key" int NOT NULL DEFAULT 4;
COMMENT ON COLUMN "scene_config"."route_key" IS '路由策略';

ALTER TABLE "scene_config" ADD COLUMN "executor_timeout" int NOT NULL DEFAULT 5;
COMMENT ON COLUMN "scene_config"."executor_timeout" IS '超时时间';



-- 分布式调度DDL
CREATE TABLE job
(
    id               BIGSERIAL PRIMARY KEY,
    group_name       VARCHAR(64)  NOT NULL,
    job_name         VARCHAR(64)  NOT NULL,
    args_str         TEXT         NOT NULL,
    args_type        SMALLINT     NOT NULL DEFAULT 1,
    next_trigger_at  BIGINT       NOT NULL,
    job_status       SMALLINT     NOT NULL DEFAULT 1,
    task_type        SMALLINT     NOT NULL DEFAULT 1,
    route_key        SMALLINT     NOT NULL DEFAULT 4,
    executor_type    SMALLINT     NOT NULL DEFAULT 1,
    executor_info    VARCHAR(255)          DEFAULT NULL,
    trigger_type     SMALLINT     NOT NULL,
    trigger_interval VARCHAR(255) NOT NULL,
    block_strategy   SMALLINT     NOT NULL DEFAULT 1,
    executor_timeout INT          NOT NULL DEFAULT 0,
    max_retry_times  INT          NOT NULL DEFAULT 0,
    parallel_num     INT          NOT NULL DEFAULT 1,
    retry_interval   INT          NOT NULL DEFAULT 0,
    bucket_index     INT          NOT NULL DEFAULT 0,
    resident         SMALLINT     NOT NULL DEFAULT 0,
    description      VARCHAR(256) NOT NULL DEFAULT '',
    ext_attrs        VARCHAR(256)          DEFAULT NULL,
    create_dt        TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_dt        TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    deleted          SMALLINT     NOT NULL DEFAULT 0
);

CREATE INDEX "idx_group_name_to_job" ON "job" ("group_name");
CREATE INDEX "idx_job_status_bucket_index_job" ON "job" ("job_status", "bucket_index");
CREATE INDEX "idx_create_dt_job" ON "job" ("create_dt");

COMMENT ON COLUMN "job"."id" IS '主键';
COMMENT ON COLUMN "job"."group_name" IS '组名称';
COMMENT ON COLUMN "job"."job_name" IS '名称';
COMMENT ON COLUMN "job"."args_str" IS '执行方法参数';
COMMENT ON COLUMN "job"."args_type" IS '参数类型';
COMMENT ON COLUMN "job"."next_trigger_at" IS '下次触发时间';
COMMENT ON COLUMN "job"."job_status" IS '重试状态 0、关闭、1、开启';
COMMENT ON COLUMN "job"."task_type" IS '任务类型 1、集群 2、广播 3、切片';
COMMENT ON COLUMN "job"."route_key" IS '路由策略';
COMMENT ON COLUMN "job"."executor_type" IS '执行器类型';
COMMENT ON COLUMN "job"."executor_info" IS '执行器名称';
COMMENT ON COLUMN "job"."trigger_type" IS '触发类型 1.CRON 表达式 2. 固定时间';
COMMENT ON COLUMN "job"."trigger_interval" IS '间隔时长';
COMMENT ON COLUMN "job"."block_strategy" IS '阻塞策略 1、丢弃 2、覆盖 3、并行';
COMMENT ON COLUMN "job"."executor_timeout" IS '任务执行超时时间，单位秒';
COMMENT ON COLUMN "job"."max_retry_times" IS '最大重试次数';
COMMENT ON COLUMN "job"."parallel_num" IS '并行数';
COMMENT ON COLUMN "job"."retry_interval" IS '更新重试间隔(s)';
COMMENT ON COLUMN "job"."bucket_index" IS 'bucket';
COMMENT ON COLUMN "job"."resident" IS '是否是常驻任务';
COMMENT ON COLUMN "job"."description" IS '描述';
COMMENT ON COLUMN "job"."ext_attrs" IS '扩展字段';
COMMENT ON COLUMN "job"."create_dt" IS '创建时间';
COMMENT ON COLUMN "job"."deleted" IS '逻辑删除 1、删除';
COMMENT ON COLUMN "job"."update_dt" IS '更新时间';
COMMENT ON TABLE "job" IS '任务信息';

CREATE TABLE job_log_message
(
    id            BIGSERIAL PRIMARY KEY,
    group_name    VARCHAR(64) NOT NULL,
    job_id        BIGINT      NOT NULL,
    task_batch_id BIGINT      NOT NULL,
    task_id       BIGINT      NOT NULL,
    message       TEXT        NOT NULL,
    ext_attrs     VARCHAR(256)         DEFAULT '',
    create_dt     TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX "idx_group_name_to_job_log_message" ON "job_log_message" ("group_name");
CREATE INDEX "idx_task_batch_id_task_id_to_job_log_message" ON "job_log_message" ("task_batch_id", "task_id");
CREATE INDEX "idx_create_dt_to_job_log_message" ON "job_log_message" ("create_dt");
COMMENT ON COLUMN "job_log_message"."id" IS '主键';
COMMENT ON COLUMN "job_log_message"."group_name" IS '组名称';
COMMENT ON COLUMN "job_log_message"."job_id" IS '任务信息id';
COMMENT ON COLUMN "job_log_message"."task_batch_id" IS '任务批次id';
COMMENT ON COLUMN "job_log_message"."task_id" IS '调度任务id';
COMMENT ON COLUMN "job_log_message"."message" IS '调度信息';
COMMENT ON COLUMN "job_log_message"."create_dt" IS '创建时间';
COMMENT ON COLUMN "job_log_message"."ext_attrs" IS '扩展字段';
COMMENT ON TABLE "job_log_message" IS '调度日志';










CREATE TABLE job_task
(
    id             BIGSERIAL PRIMARY KEY,
    group_name     VARCHAR(64) NOT NULL,
    job_id         BIGINT      NOT NULL,
    task_batch_id  BIGINT      NOT NULL,
    parent_id      BIGINT      NOT NULL DEFAULT 0,
    task_status    SMALLINT    NOT NULL DEFAULT 0,
    retry_count    INT         NOT NULL DEFAULT 0,
    client_info    VARCHAR(128)         DEFAULT NULL,
    result_message TEXT        NOT NULL,
    args_str       TEXT        NOT NULL,
    args_type      SMALLINT    NOT NULL DEFAULT 1,
    ext_attrs      VARCHAR(256)         DEFAULT '',
    create_dt      TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_dt      TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP
);


CREATE INDEX "idx_group_name_to_job_task" ON "job_task" ("group_name");
CREATE INDEX "idx_task_batch_id_task_status_to_job_task" ON "job_task" ("task_batch_id", "task_status");
CREATE INDEX "idx_create_dt_to_job_task" ON "job_task" ("create_dt");
COMMENT ON COLUMN "job_task"."id" IS '主键';
COMMENT ON COLUMN "job_task"."group_name" IS '组名称';
COMMENT ON COLUMN "job_task"."job_id" IS '任务信息id';
COMMENT ON COLUMN "job_task"."task_batch_id" IS '任务批次id';
COMMENT ON COLUMN "job_task"."parent_id" IS '父执行器id';
COMMENT ON COLUMN "job_task"."task_status" IS '执行的状态 0、失败 1、成功';
COMMENT ON COLUMN "job_task"."retry_count" IS '重试次数';
COMMENT ON COLUMN "job_task"."client_info" IS '客户端地址 clientId#ip:port';
COMMENT ON COLUMN "job_task"."result_message" IS '调度信息';
COMMENT ON COLUMN "job_task"."args_str" IS '执行方法参数';
COMMENT ON COLUMN "job_task"."args_type" IS '参数类型';
COMMENT ON COLUMN "job_task"."create_dt" IS '创建时间';
COMMENT ON COLUMN "job_task"."update_dt" IS '创建时间';
COMMENT ON COLUMN "job_task"."ext_attrs" IS '扩展字段';
COMMENT ON TABLE "job_task" IS '任务实例';

CREATE TABLE job_task_batch
(
    id                BIGSERIAL PRIMARY KEY,
    group_name        VARCHAR(64) NOT NULL,
    job_id            BIGINT      NOT NULL,
    parent_id         VARCHAR(64) NOT NULL DEFAULT '',
    task_batch_status SMALLINT    NOT NULL DEFAULT 0,
    operation_reason  SMALLINT    NOT NULL DEFAULT 0,
    execution_at      BIGINT      NOT NULL DEFAULT 0,
    ext_attrs         VARCHAR(256)         DEFAULT '',
    deleted           SMALLINT    NOT NULL DEFAULT 0,
    create_dt         TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_dt         TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX "idx_group_name_to_job_task_batch" ON "job_task_batch" ("group_name");
CREATE INDEX "idx_job_id_task_batch_status_to_job_task_batch" ON "job_task_batch" ("job_id", "task_batch_status");
CREATE INDEX "idx_create_dt_to_job_task_batch" ON "job_task_batch" ("create_dt");
COMMENT ON COLUMN "job_task_batch"."id" IS '主键';
COMMENT ON COLUMN "job_task_batch"."group_name" IS '组名称';
COMMENT ON COLUMN "job_task_batch"."job_id" IS '任务信息id';
COMMENT ON COLUMN "job_task_batch"."task_batch_status" IS '任务批次状态 0、失败 1、成功';
COMMENT ON COLUMN "job_task_batch"."operation_reason" IS '操作原因';
COMMENT ON COLUMN "job_task_batch"."execution_at" IS '任务执行时间';
COMMENT ON COLUMN "job_task_batch"."parent_id" IS '父节点';
COMMENT ON COLUMN "job_task_batch"."deleted" IS '逻辑删除 1、删除';
COMMENT ON COLUMN "job_task_batch"."create_dt" IS '创建时间';
COMMENT ON COLUMN "job_task_batch"."update_dt" IS '创建时间';
COMMENT ON COLUMN "job_task_batch"."ext_attrs" IS '扩展字段';
COMMENT ON TABLE "job_task" IS '任务批次';
```
  </code-block>

</code-group>